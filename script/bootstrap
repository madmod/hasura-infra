#!/bin/bash

set -euo pipefail

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"
ROOT="$DIR/.."

pushd $ROOT
npm i
pipenv install
popd

. $ROOT/script/lib/parse-opts.sh

$ROOT/$HASURA_SCRIPT_PREFIX/bootstrap

eval `$ROOT/script/env.sh`

$ROOT/script/lib/start-db-tunnel
sleep 5

$ROOT/script/update-config
npx sequelize db:migrate

$ROOT/script/import-metadata

$ROOT/script/lib/stop-db-tunnel